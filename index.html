<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>بطاقة تهنئة بالعيد</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom, #fefcea, #f1da36);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      direction: rtl;
    }

    .card-container {
      position: relative;
      /* هنا نحدد الحجم حسب أبعاد الصورة الأصلية */
      width: 400px;  /* مثال عرض الصورة */
      height: 600px; /* مثال طول الصورة */
      background: url('eidy.png') no-repeat center center;
      background-size: auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      overflow: hidden;
    }

    /* صورة المستخدم دائرية */
    #userImage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 150px;  /* يمكن تصغير أو تكبير */
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid white;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      cursor: move;
    }

    /* اسم المستخدم */
    #userName {
      position: absolute;
      top: calc(50% + 90px);
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      color: #222;
      text-shadow: 1px 1px 3px white;
      cursor: move;
      user-select: none;
    }

    /* مدخلات تحكم */
    .controls {
      margin-top: 20px;
      text-align: center;
    }

    input[type="file"], input[type="text"], button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #d6336c;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #c8235d;
    }
  </style>
</head>
<body>

  <div class="card-container" id="cardContainer">
    <img id="userImage" src="" alt="صورة المستخدم" style="display:none" />
    <div id="userName" style="display:none">اسمك هنا</div>
  </div>

  <div class="controls">
    <input type="file" id="imageInput" accept="image/*" />
    <input type="text" id="nameInput" placeholder="اكتب اسمك هنا" />
    <button onclick="generateGreeting()">أنشئ التهنئة</button>
    <button onclick="downloadCard()">تحميل التهنئة</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const userImage = document.getElementById('userImage');
    const userName = document.getElementById('userName');
    const cardContainer = document.getElementById('cardContainer');

    // تحميل صورة المستخدم
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          userImage.src = evt.target.result;
          userImage.style.display = 'block';
          userImage.style.top = '50%';  // إعادة تعيين المواضع
          userImage.style.left = '50%';
          userImage.style.transform = 'translate(-50%, -50%)';
        };
        reader.readAsDataURL(file);
      }
    });

    // إنشاء التهنئة
    function generateGreeting() {
      const name = document.getElementById('nameInput').value.trim();
      if (name) {
        userName.textContent = name;
        userName.style.display = 'block';
        userName.style.top = 'calc(50% + 90px)';
        userName.style.left = '50%';
        userName.style.transform = 'translateX(-50%)';
      }
    }

    // سحب الصورة والنص معا
    function makeDraggable(element) {
      let isDragging = false, startX, startY, origX, origY;

      element.style.position = 'absolute';

      element.addEventListener('mousedown', e => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = element.getBoundingClientRect();
        origX = rect.left;
        origY = rect.top;
        e.preventDefault();
      });

      document.addEventListener('mousemove', e => {
        if (isDragging) {
          let dx = e.clientX - startX;
          let dy = e.clientY - startY;
          element.style.left = origX + dx + 'px';
          element.style.top = origY + dy + 'px';
        }
      });

      document.addEventListener('mouseup', e => {
        isDragging = false;
      });
    }

    makeDraggable(userImage);
    makeDraggable(userName);

    // تحميل الكارد كصورة
    function downloadCard() {
      html2canvas(cardContainer, {scale: 3}).then(canvas => {
        const link = document.createElement('a');
        link.download = 'eid_greeting.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }
  </script>

</body>
</html>
